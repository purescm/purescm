;; DO NOT EDIT THIS FILE!!
;; This inlined chez-srfi library code is autogenerated using command:
;; $ ./install.chezscheme.sps ../vendor
;; Source origin: https://github.com/arcfide/chez-srfi
;; Please refer to project site for full credits and original code.
;;;;;; File header: %3a98/os-environment-variables.mzscheme.sls
#!r6rs
;; Copyright 2009 Derick Eddington.  My MIT-style license is in the file named
;; LICENSE from the original collection this file is distributed with.
(library (srfi :98 os-environment-variables)
  (export
    (rename (getenv get-environment-variable))
    get-environment-variables)
  (import
    (rnrs base)
    (only (scheme base) getenv)
    (scheme foreign))
  (unsafe!)
  (define environ
    (get-ffi-obj "environ" (ffi-lib #f) _pointer))
  (define (get-environment-variables)
    (let loop ([i 0] [accum '()])
      (let ([next (ptr-ref environ _string/locale i)])
        (if next
            (loop
              (+ 1 i)
              (cons
                (let loop ([i 0] [len (string-length next)])
                  (if (< i len)
                      (if (char=? #\= (string-ref next i))
                          (cons
                            (substring next 0 i)
                            (substring next (+ 1 i) len))
                          (loop (+ 1 i) len))
                      (cons next #f)))
                accum))
            accum)))))
